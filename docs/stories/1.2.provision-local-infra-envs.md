# Story 1.2: Provision Local Infrastructure & Environments

## Status
Draft

## Story
**As a** HaiGo engineer preparing to run the stack locally,
**I want** scripted local infrastructure (Postgres, Redis, MinIO) and environment templates,
**so that** every contributor can bring the full system up consistently and safely.

## Acceptance Criteria
1. A `docker-compose.yml` (or Compose stack) provisions Postgres, Redis, and MinIO with default creds and ports matching Architecture guidance (`docs/architecture.md:21`).
2. Scripts `pnpm run setup` and `pnpm run db:setup` automate environment file generation and container bootstrapping consistent with Project Setup steps (`docs/architecture.md:26`).
3. `.env.example` covers Aptos fullnode/indexer URLs, object storage credentials, Postgres/Redis URIs, API keys, and Move config placeholders (`docs/architecture.md:30`).
4. Documentation explains how to copy `.env.example` to `.env.local`/`.env.development` for each app (`docs/architecture.md:31`).
5. Running `pnpm run dev:web`, `pnpm run dev:bff`, and `pnpm run dev:move` after setup succeeds with containers online (`docs/architecture.md:30`).
6. Compose services expose health/liveness commands and tear-down instructions (`docs/architecture.md:1002`).
7. Regression: stopping Compose stack leaves repository clean; rerunning setup is idempotent.
8. README (or `docs/architecture.md` append) updated with troubleshooting tips for Docker/MinIO credentials.

## Tasks / Subtasks
- [ ] Author Docker Compose with Postgres/Redis/MinIO defaults (AC:1)
  - [ ] Define volumes, ports, env vars with sensible defaults
  - [ ] Document credentials in `.env.example`
- [ ] Implement setup scripts (AC:2)
  - [ ] `pnpm run setup`: clone `.env.example` to per-app env files
  - [ ] `pnpm run db:setup`: run `docker compose up -d` and seed migrations
- [ ] Populate environment templates (AC:3-4)
  - [ ] Include Aptos RPC/indexer/testnet variables referencing `docs/architecture.md`
  - [ ] Add placeholders for S3/MinIO bucket + credentials
- [ ] Verify dev commands (AC:5)
  - [ ] Run each dev script to confirm services connect to Compose stack
  - [ ] Capture connection URIs in docs
- [ ] Add observability + teardown notes (AC:6-8)
  - [ ] Document `docker compose down -v` and health check commands
  - [ ] Update README / Architecture Project Setup section

## Dev Notes
- Align Compose service names with future deployment naming (Architecture ยง6 hints at API endpoints `https://api.haigo.dev`).
- MinIO credentials should map to BFF `/media/presign` expectations (`docs/architecture.md:596`).
- Database schema bootstrap can reference PRD data model placeholders (`docs/prd.md:134`).
- Ensure scripts run on macOS + Linux shells; prefer Node scripts or cross-platform tools.

### Testing
- Execute `pnpm run setup`, `pnpm run db:setup`, `pnpm run dev:*` sequentially to confirm idempotent behavior.
- Validate `docker compose ps` reports healthy services; include healthcheck endpoints in README.
- Smoke-test BFF can reach Postgres/Redis using provided envs.

## Change Log
| Date       | Version | Description                              | Author |
|------------|---------|------------------------------------------|--------|
| 2025-09-16 | v0.1    | Initial draft created from Epic Story 2. | Sarah  |

## Dev Agent Record
### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

## QA Results

