# 4. 技术假设

## 4.1 代码库结构
- 采用 Monorepo，集中维护 Move 合约、后端索引服务、前端 dApp 与共享工具集。

## 4.2 服务架构
- 模块化单体 + 只读事件监听器：
  - 所有写操作（Create/Check-in/Set Storage/Check-out/Stake/Claim/Rate）由前端钱包直连 Aptos 完成。
  - BFF/Indexer 仅负责读取、聚合、搜索、媒体预签名上传和风控 Hook，不代签、不代付、不代理广播。
  - 读操作区分：详情与关键判断直读链或 Indexer RPC；列表/排行等可读 BFF 并在细节页再次直链校验。

## 4.3 测试策略
- Move 合约单元测试覆盖状态机、权限、事件与错误码。
- 后端与前端提供集成测试验证钱包交互、事件处理与媒体哈希校验。
- 关键链上链下流程提供模拟/回放测试，确保异常场景可复现。

## 4.4 补充假设
- 对象存储统一使用 S3/MinIO，通过预签名 URL 上传媒体，链上仅存 `ContentHash`。
- 索引数据库采用 PostgreSQL（JSONB）+ Redis 缓存；基础设施通过 Terraform 等 IaC 管理。
- 前端使用 React + Aptos 钱包适配库（Petra、Martian 等），封装交易签名、Gas 估算与事件监听。
- CI/CD 在 Monorepo 层运行：Move 编译/测试、后端 lint/test、前端 lint/build + 基础 E2E 烟测；Testnet 分支自动部署，Mainnet 发布需人工审批。
- 钱包运营密钥与敏感配置托管于 KMS/安全模块，避免明文暴露。
