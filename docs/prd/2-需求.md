# 2. 需求

## 2.1 功能性需求（FR）
1. **FR1**: 平台必须支持商家与仓主使用 Aptos 钱包地址完成注册与身份标记，并允许绑定链下档案哈希。
2. **FR2**: 系统需提供仓库筛选与列表浏览功能，支持按地区、价格、评分、质押额度与容量标签等维度过滤。
3. **FR3**: 商家应能创建订单并一次性链上支付仓储费与保险费，生成唯一 `record_uid` 并记录支付交易哈希。
4. **FR4**: 仓主须在入库时提交快递单号与媒体内容哈希，上链记录入库事件与时间戳。
5. **FR5**: 平台应维护订单状态机（ORDER_CREATED → WAREHOUSE_IN → IN_STORAGE → WAREHOUSE_OUT）并在每次状态变更时触发链上事件。
6. **FR6**: 出库流程需要记录出库单号与媒体内容哈希，上链保存出库事件与时间戳，实现订单闭环。
7. **FR7**: 质押模块需允许仓主在 Aptos 上质押 APT/USDT 并调整质押状态，同时公开质押金额与信用权重。
8. **FR8**: 保险合约必须支持商家或平台提交理赔申请（附证据哈希），并记录审批结果、赔付金额及事件。
9. **FR9**: 平台需提供仓主评分与评价流程，允许商家提交评分和链下评价哈希，并触发评价事件。
10. **FR10**: 数据索引/聚合层需实时监听链上事件，为前端提供统计、地图和排行榜等可视化接口。

## 2.2 非功能性需求（NFR）
1. **NFR1**: 所有链上合约须通过安全审计，关键函数需进行权限与签名校验，防止重放与越权操作。
2. **NFR2**: 仅关键业务字段上链，大体量媒体文件存储于链下对象存储，并保证内容哈希一致性验证。
3. **NFR3**: 系统需满足跨境合规要求，支持后续扩展 KYC/AML 流程并确保敏感信息链下管理。
4. **NFR4**: 集成高可用监控与告警能力，包括事件监听滞后、哈希校验失败与订单状态异常等场景。
5. **NFR5**: 交易与索引流程需优化 Gas 与查询性能，确保在高并发时仍能快速反馈核心状态变化。
6. **NFR6**: 平台必须支持多语言界面与面向国际用户的时区、货币显示，确保 UX 一致性。
7. **NFR7**: 提供完整的测试策略（单元、集成、事件回放）以验证状态机、保险理赔及质押流程的正确性。
8. **NFR8**: 数据留存与日志要满足可追溯性需求，支持合规审计期间的链上链下证据对照。
