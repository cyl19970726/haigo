# HaiGo 架构说明（PoC v0）

## Table of Contents

- [HaiGo 架构说明（PoC v0）](#table-of-contents)
  - [Introduction](./introduction.md)
    - [Starter Template or Existing Project](./introduction.md#starter-template-or-existing-project)
    - [Change Log](./introduction.md#change-log)
  - [High Level Architecture](./high-level-architecture.md)
    - [Technical Summary](./high-level-architecture.md#technical-summary)
    - [Platform and Infrastructure Choice](./high-level-architecture.md#platform-and-infrastructure-choice)
    - [Repository Structure](./high-level-architecture.md#repository-structure)
  - [1. 架构目标与范围](./1-架构目标与范围.md)
  - [2. 系统分层概览](./2-系统分层概览.md)
    - [2.1 全栈交互示意图](./2-系统分层概览.md#21-全栈交互示意图)
  - [3. 链上合约设计](./3-链上合约设计.md)
    - [3.1 Registry 模块](./3-链上合约设计.md#31-registry-模块)
      - [状态结构](./3-链上合约设计.md#状态结构)
      - [关键入口函数](./3-链上合约设计.md#关键入口函数)
      - [约束与交互](./3-链上合约设计.md#约束与交互)
    - [3.2 Orders 模块](./3-链上合约设计.md#32-orders-模块)
      - [状态结构](./3-链上合约设计.md#状态结构-1)
      - [状态机流程](./3-链上合约设计.md#状态机流程)
      - [约束与交互](./3-链上合约设计.md#约束与交互-1)
      - [事件载荷](./3-链上合约设计.md#事件载荷)
    - [3.3 Staking 模块](./3-链上合约设计.md#33-staking-模块)
      - [状态结构](./3-链上合约设计.md#状态结构-2)
      - [关键入口函数](./3-链上合约设计.md#关键入口函数-1)
      - [约束与交互](./3-链上合约设计.md#约束与交互-2)
    - [3.4 Insurance 模块](./3-链上合约设计.md#34-insurance-模块)
      - [状态结构](./3-链上合约设计.md#状态结构-3)
      - [关键入口函数](./3-链上合约设计.md#关键入口函数-2)
      - [约束与交互](./3-链上合约设计.md#约束与交互-3)
    - [3.5 Reputation 模块](./3-链上合约设计.md#35-reputation-模块)
      - [状态结构](./3-链上合约设计.md#状态结构-4)
      - [关键入口函数](./3-链上合约设计.md#关键入口函数-3)
      - [约束与交互](./3-链上合约设计.md#约束与交互-4)
    - [3.6 模块交互与依赖关系](./3-链上合约设计.md#36-模块交互与依赖关系)
    - [3.7 权限与安全控制](./3-链上合约设计.md#37-权限与安全控制)
    - [3.8 事件与索引策略](./3-链上合约设计.md#38-事件与索引策略)
    - [3.9 测试与部署](./3-链上合约设计.md#39-测试与部署)
      - [3.2.4 媒体存证字段与约束](./3-链上合约设计.md#324-媒体存证字段与约束)
      - [3.2.5 费用与支付约束](./3-链上合约设计.md#325-费用与支付约束)
      - [3.2.6 Story 对齐清单](./3-链上合约设计.md#326-story-对齐清单)
      - [3.2.7 测试矩阵（Epic 2）](./3-链上合约设计.md#327-测试矩阵epic-2)
      - [3.2.8 与链下协作要点](./3-链上合约设计.md#328-与链下协作要点)
  - [4. 链下服务与数据流](./4-链下服务与数据流.md)
    - [4.1 BFF / Indexer Ingest 管线](./4-链下服务与数据流.md#41-bff-indexer-ingest-管线)
      - [4.1.1 数据流概览](./4-链下服务与数据流.md#411-数据流概览)
      - [4.1.2 轮询与容错](./4-链下服务与数据流.md#412-轮询与容错)
      - [4.1.3 环境变量](./4-链下服务与数据流.md#413-环境变量)
    - [4.2 数据模型定义](./4-链下服务与数据流.md#42-数据模型定义)
      - [4.2.1 当前实现（accounts）](./4-链下服务与数据流.md#421-当前实现accounts)
      - [4.2.2 规划中的表](./4-链下服务与数据流.md#422-规划中的表)
    - [4.3 媒体存储策略](./4-链下服务与数据流.md#43-媒体存储策略)
    - [4.4 BFF API 接口规范](./4-链下服务与数据流.md#44-bff-api-接口规范)
    - [4.5 Hasura GraphQL 摘要](./4-链下服务与数据流.md#45-hasura-graphql-摘要)
    - [4.6 核心接口与类设计](./4-链下服务与数据流.md#46-核心接口与类设计)
    - [4.7 订单生命周期数据管线计划](./4-链下服务与数据流.md#47-订单生命周期数据管线计划)
      - [4.7.1 事件→数据流拓扑](./4-链下服务与数据流.md#471-事件数据流拓扑)
      - [4.7.2 数据模型拓展](./4-链下服务与数据流.md#472-数据模型拓展)
      - [4.7.3 BFF 模块设计](./4-链下服务与数据流.md#473-bff-模块设计)
      - [4.7.4 API 规划](./4-链下服务与数据流.md#474-api-规划)
      - [4.7.5 媒体存证协同](./4-链下服务与数据流.md#475-媒体存证协同)
      - [4.7.6 实施顺序建议](./4-链下服务与数据流.md#476-实施顺序建议)
      - [4.7.7 与 Epic 2 Story 对齐项](./4-链下服务与数据流.md#477-与-epic-2-story-对齐项)
      - [4.7.8 前端/后端数据契约扩展](./4-链下服务与数据流.md#478-前端后端数据契约扩展)
      - [4.7.9 运行与测试要求](./4-链下服务与数据流.md#479-运行与测试要求)
      - [4.7.10 后续演进关注](./4-链下服务与数据流.md#4710-后续演进关注)
  - [5. 前端体验](./5-前端体验.md)
  - [6. 部署与环境](./6-部署与环境.md)
    - [6.1 本地 Docker PoC 环境（Postgres + Hasura）](./6-部署与环境.md#61-本地-docker-poc-环境postgres-hasura)
      - [6.1.1 前置依赖](./6-部署与环境.md#611-前置依赖)
      - [6.1.2 Compose 模板](./6-部署与环境.md#612-compose-模板)
      - [6.1.3 启动与健康检查](./6-部署与环境.md#613-启动与健康检查)
      - [6.1.4 数据初始化](./6-部署与环境.md#614-数据初始化)
      - [6.1.5 常见问题](./6-部署与环境.md#615-常见问题)
      - [6.1.6 Epic 2 附加组件：订单监听与媒体存储](./6-部署与环境.md#616-epic-2-附加组件订单监听与媒体存储)
    - [6.2 宿主机运行 BFF 与 Web](./6-部署与环境.md#62-宿主机运行-bff-与-web)
      - [6.2.1 Epic 2 运行参数与服务约定](./6-部署与环境.md#621-epic-2-运行参数与服务约定)
    - [6.3 测试网环境](./6-部署与环境.md#63-测试网环境)
      - [6.3.1 Move 模块部署（Story 2.1）](./6-部署与环境.md#631-move-模块部署story-21)
      - [6.3.2 媒体存储与对象服务（Story 2.3）](./6-部署与环境.md#632-媒体存储与对象服务story-23)
      - [6.3.3 订单索引与监控（Story 2.4）](./6-部署与环境.md#633-订单索引与监控story-24)
    - [6.4 CI/CD](./6-部署与环境.md#64-cicd)
      - [6.4.1 Epic 2 持续集成要求](./6-部署与环境.md#641-epic-2-持续集成要求)
    - [6.5 基础设施即代码](./6-部署与环境.md#65-基础设施即代码)
      - [6.5.1 Epic 2 补充资源](./6-部署与环境.md#651-epic-2-补充资源)
    - [6.6 Epic 2 验收检查表（部署视角）](./6-部署与环境.md#66-epic-2-验收检查表部署视角)
  - [7. 安全、合规与运维](./7-安全合规与运维.md)
  - [8. 演进路线](./8-演进路线.md)
  - [9. 附件](./9-附件.md)
