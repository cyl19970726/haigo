# 3. 链上合约设计
| 模块 | 功能要点 | 主要事件 |
|------|----------|----------|
| `hai_go::registry` | 商家/仓主注册、档案哈希存储；重复注册和权限校验 | `SellerRegistered`, `WarehouseRegistered` |
| `hai_go::orders` | 订单状态机（`ORDER_CREATED → WAREHOUSE_IN → IN_STORAGE → WAREHOUSE_OUT`）、费用记录、物流单号、媒体哈希 | `OrderCreated`, `CheckedIn`, `SetInStorage`, `CheckedOut` |
| `hai_go::staking` | APT/稳定币质押与信用权重；多次变更生成快照 | `StakeChanged` |
| `hai_go::insurance` | 理赔开启、审批/拒绝及赔付金额记录 | `ClaimOpened`, `ClaimResolved` |
| `hai_go::reputation` | 仓主评分与链下评价哈希记录 | `RatingSubmitted` |

Move 单元测试覆盖：正常流程、权限/状态机异常、重复调用、事件字段校验。部署通过脚本输出模块地址，供前端和 BFF 使用。

## Registry 模块状态结构
- 全局注册信息由 `Registry` 资源托管，资源发布在平台资源账户的 `hai_go::registry` 模块下。
- `Registry` 内部维护 `table::Table<address, AccountRecord>`，键为注册地址，值包含：
  - 角色枚举（`seller` / `warehouse`）
  - 档案哈希元数据（算法、值、可选 URI）
  - 注册交易版本与事件索引，便于索引器回放
- 额外布尔标识跟踪地址是否以特定角色注册，防止重复注册。
- 事件句柄保存在 `Registry` 资源中，分别对应 `SellerRegistered` 与 `WarehouseRegistered`，供 Aptos Indexer 与链下服务消费。
