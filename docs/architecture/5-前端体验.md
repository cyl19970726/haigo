# 5. 前端体验

> 前端代码集中在 `apps/web`，采用 Next.js App Router。所有页面和能力均围绕最新的登录会话、注册、目录以及仪表盘流程展开，本文档仅保留当前版本所需的核心信息与主要锚点。

## 5.1 核心模块锚点
| 区域 | 关键文件 |
|------|----------|
| 应用级 Provider | `apps/web/app/providers.tsx` |
| 钱包上下文与网络守卫 | `apps/web/lib/wallet/context.tsx`、`apps/web/lib/wallet/network-guard.tsx` |
| 会话辅助模块 | `apps/web/lib/session/ensureSession.ts`、`apps/web/lib/api/session.ts`、`apps/web/lib/server/session.ts` |
| 登录首页 | `apps/web/app/page.tsx`、`apps/web/lib/hooks/useAccountRegistration.ts` |
| 注册表单 | `apps/web/app/(auth)/register/page.tsx`、`apps/web/features/registration/RegisterView.tsx` |
| 仓库目录（卖家视角） | `apps/web/app/(seller)/warehouses/page.tsx`、`apps/web/features/directory/useWarehouseDirectory.ts` |
| 仓库/卖家仪表盘 | `apps/web/app/dashboard/layout.tsx`、`apps/web/app/dashboard/seller/page.tsx`、`apps/web/app/dashboard/warehouse/page.tsx` |


### Homepage V2（A2）详细规范
- 目标：提升转化、突出产品价值，让用户快速理解并明确操作入口。
- 版块结构：
  1) Hero：主标题、副文案，主 CTA（Connect Wallet）与次 CTA（Register），并展示信任背书。
  2) 价值网格：3–6 张卡片，包含图标、标题与简短描述。
  3) 使用流程：4 个步骤的简要可视化（Connect → Register → Create Order → Track & Verify）。
  4) 指标 / 口碑（可选）：展示关键数据或精选评价。
  5) 页脚：列出 Docs / Privacy / Contact 等链接。

ASCII Wireframe (single CTA in Hero)
```
┌──────────────────────────────────────────────────────────────┐
│  HAI GO                              [Connect] [Register]     │
│  Verifiable storage & logistics                              │
│  Cross-border, indexer-backed proofs.                         │
│                                                              │
│  [ hero-visual / gradient ]                                   │
├──────────────────────────────────────────────────────────────┤
│  ▣ Verifiable Storage   ▣ Transparent Logistics   ▣ Insurance │
│  Short copy…            Short copy…               Short copy… │
│  ▣ Indexer Proofs       ▣ Low Friction            ▣ Analytics │
│  Short copy…            Short copy…               Short copy… │
├──────────────────────────────────────────────────────────────┤
│  ① Connect → ② Register → ③ Create Order → ④ Track & Verify  │
├──────────────────────────────────────────────────────────────┤
│  1,245 Orders • 32 Warehouses • 99.9% Uptime                 │
├──────────────────────────────────────────────────────────────┤
│  © HaiGo • Docs • Privacy • Contact                          │
└──────────────────────────────────────────────────────────────┘
```

组件（shadcn）
- Button、Card、Badge、Tabs、Table、Pagination、Skeleton、Alert、Separator、Dialog、Toast、Navbar/Sheet（移动端抽屉导航）。

响应式与主题
- 断点：sm / md / lg / xl，移动优先；在小屏幕上网格折叠为单列。
- 通过 CSS 变量管理主题，尊重 `prefers-color-scheme`。

交互
- 主 CTA → 触发钱包连接 → 完成会话初始化 → 根据角色跳转；次 CTA → `/register`。
- 全程通过 `aria-live` 宣告状态，在注册查询或会话验证失败时提供重试指引。

验收标准
- 各断点下视觉一致、CTA 可用；在跳转仪表盘前已写入会话 Cookie；无障碍与性能检查通过。
## 仪表盘（卖家 / 仓库）

### 目标
- 为两个角色提供“开箱即用”的主页：集中展示最近任务/状态，并提供明显的下一步操作。

### 路由与容器
- `/dashboard/seller` → SellerDashboard 容器
- `/dashboard/warehouse` → WarehouseDashboard 容器

### Seller Cards（MVP）
- 最近订单（调用 GET /api/orders?seller=…）：显示 orderId、状态、时间戳，点击进入详情/下单向导。
- 快速下单 CTA：跳转到订单创建向导（CreateOrderView）。
- 配置提示：NEXT_PUBLIC_APTOS_NETWORK / BFF URL 缺失时提示。

### Warehouse Cards（MVP）
- 质押/存储费：调用 GET `/api/staking/intent` 显示 `stakedAmount` 与 `feePerUnit`；按钮触发 stake / fee 调整流。
- 订单收件箱：调用 GET `/api/orders?warehouse=…&page=1&pageSize=5`，展示最近 5 条订单（状态 Badge + 金额 + 创建时间）并提供“查看全部订单”链接。
- 运营快照：预留 O2 相关快捷入口，当前使用说明性占位卡片。
- 状态处理：钱包未连接时显示提示文案；加载使用 Skeleton；错误以 Alert 呈现并提供重试。

### 加载 / 错误 / 空态状态
- 初始 Skeleton；错误以 role=alert 呈现并供重试；空列表展示友好占位与说明。

### 无障碍支持
- 所有卡片标题使用语义化元素；操作按钮具备明确 aria-label；错误提示带 role=alert。

### 实现锚点
- `apps/web/app/dashboard/seller/page.tsx`
- `apps/web/app/dashboard/warehouse/page.tsx`
- `apps/web/app/(warehouse)/orders/page.tsx`
- `apps/web/features/orders/inbox/*`
- `apps/web/features/dashboard/*`

### 仓库仪表盘 ASCII 线框图（MVP）
```
┌───────────────────────────────────────────────────────────────┐
│  仓库工作台                                       [帮助] [文档] │
├───────────────────────────────────────────────────────────────┤
│  Staking & Storage Fee                                     ┌───┐│
│  ┌────────────────────────────┐  ┌──────────────────────┐ │CTA││
│  │  Staked Amount             │  │  Storage Fee (bps)   │ └───┘│
│  │  1,200 APT                 │  │  25                  │      │
│  │  [Stake] [Adjust Fee]      │  │                      │      │
│  └────────────────────────────┘  └──────────────────────┘      │
├───────────────────────────────────────────────────────────────┤
│  Orders Inbox (latest 5)                                       │
│  ┌─────────────────────────────────────────────────────────┐  │
│  │  CREATED     #123   120.00 APT   09-19 10:31   查看详情 │  │
│  │  IN_STORAGE  #122    98.50 APT   09-18 18:04   查看详情 │  │
│  │  WAREHOUSE_IN#121    76.10 APT   09-18 16:22   查看详情 │  │
│  │  …（Skeleton / 空态 / 错误提示）                         │  │
│  └─────────────────────────────────────────────────────────┘  │
│                                              [查看全部订单]→ │
├───────────────────────────────────────────────────────────────┤
│  Ops Snapshot (placeholder)                                    │
│  ┌─────────────────────────────────────────────────────────┐  │
│  │  说明文案与未来指标占位。                               │  │
│  └─────────────────────────────────────────────────────────┘  │
└───────────────────────────────────────────────────────────────┘
### 用户操作（通用）— 退出登录 / Sign out
- 放置位置：Dashboard 顶部右侧，与帮助/文档并列；移动端折叠在溢出菜单。
- 行为顺序：`POST /api/session/logout` → `wallet.disconnect()` → 清理本地缓存（如 `haigo:orders:create`）→ 跳转 `/`。
- 失败容错：任一步失败不阻断整体退出流程；以 `aria-live=polite` 宣告“已退出登录”。
- 无障碍：按钮带 `aria-label="Sign out"`，可键盘导航，焦点可见。
- 实现锚点：
  - `apps/web/app/dashboard/seller/page.tsx`（按钮放置）
  - `apps/web/app/dashboard/warehouse/page.tsx`（按钮放置）
  - `apps/web/features/auth/SignOutButton.tsx`（组件实现）

说明：
- “Staking & Storage Fee” 卡片：读取 `/api/staking/intent`，按钮触发钱包签名以调整质押或费率。
- “Orders Inbox” 卡片：读取 `/api/orders?...pageSize=5`，展示最新订单并提供跳转入口。
- 运营快照：占位，后续用于呈现库存 / 告警等指标。
```

### 仓库收件箱卡片（Orders Inbox）交互细节
- 内容结构
  - 字段包含：`status` 徽标（映射中文状态）、`orderId`（若缺失则回退 `recordUid`）、总金额（`pricing.totalSubunits` → APT）、`createdAt`（本地时间）、可选截断显示的 `transactionHash`。
  - 行尾动作为“查看详情”，跳转 `/(warehouse)/orders/[recordUid]/check-in`。
- 密度与数量限制
  - 固定渲染最新 5 条（`createdAt desc`），避免出现滚动条；保留 `aria-live="polite"` 用于播报刷新结果。
  - 底部“查看全部订单”链接跳转完整列表；未连接钱包时禁用并提示。
- 状态管理
  - 未连接钱包：正文展示“连接仓库钱包即可查看专属订单收件箱”。
  - 异常：卡片内展示 shadcn `Alert`，包含错误信息与重试指引。
- 加载 / 空态
  - 加载：使用 5 行 Skeleton，高度与最终内容一致。
  - 空态：展示“暂无待处理订单”及补充说明。

### 仓库订单列表页面（`/(warehouse)/orders`）
- 顶部 Header：包含标题、描述及描边样式的刷新按钮（调用同一 API 重新获取数据）。
- 状态标签页：`ALL`、`PENDING`、`CREATED`、`WAREHOUSE_IN`、`IN_STORAGE`、`WAREHOUSE_OUT`；切换时重置 `page=1` 并重新请求数据。
- 列表：使用 shadcn Table，列顺序为 `orderId / 状态 / 总金额 / 创建时间 / Txn Hash / 操作`。
- 分页：`PaginationPrevious`、`PaginationNext` 控件同步 `page`；文案示例“共 X 条 · 第 Y/Z 页”。
- 错误与空态：复用 Alert + 虚线边框占位；加载态使用 Skeleton 列表。
- 未连接钱包：顶部 Info Alert 提示用户先连接仓库钱包。
- 性能建议：限制不必要的重渲染，使用 memo 化行组件，避免前端自行排序/分页，交由 API 处理。
- 规划中的锚点：
  - `apps/web/app/dashboard/warehouse/page.tsx`（卡片渲染）
  - `apps/web/app/(warehouse)/orders/page.tsx`（完整列表、分页与筛选）
  - `apps/web/features/orders/inbox/WarehouseOrders.tsx`（数据与状态管理）

### 卖家仪表盘 ASCII 线框图（MVP）
```
┌─────────────────────────────────────────────────────────────────┐
│  Welcome, 0xSELLER…                     [Help] [Docs]          │
├─────────────────────────────────────────────────────────────────┤
│  Recent Orders                                                  │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │  #231  CREATED     2025-09-19 10:31  [View] [New Order]  │  │
│  │  #230  IN_STORAGE  2025-09-18 18:04  [View]              │  │
│  │  #229  WAREHOUSE_IN 2025-09-18 16:22 [View]              │  │
│  └───────────────────────────────────────────────────────────┘  │
├─────────────────────────────────────────────────────────────────┤
│  Find Warehouses (Listing)                                      │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │  [Search q=...] [Area] [Fee<=] [Score>=] [Sort▼]         │  │
│  │  [  Explore Warehouses  ]                                │  │
│  └───────────────────────────────────────────────────────────┘  │
├─────────────────────────────────────────────────────────────────┤
│  Quick Actions                                                  │
│  [New Order]   [My Orders]   [Profile]                         │
└─────────────────────────────────────────────────────────────────┘
说明：
- “Recent Orders” 区域：调用 GET `/api/orders?seller=…`，展示最新订单。
- “Find Warehouses” 区域：跳转 L1 Listing 页面（带初始筛选），并在选择仓库后进入下单向导。
```

## Create Order（商家）— UI/UX

### 流程
1) Seller Dashboard → 点击“Find Warehouses”进入 Listing（L1）。
2) 在 Listing 中选择家庭仓 → 进入 “Create Order” 页面，并默认带入仓库地址。
3) 填写物流信息（必填：快递单号；可选：承运商 / 备注），确认金额（PoC 阶段可内置默认费率）。
4) 点击 “Sign & Submit” 调用钱包签名，将订单信息上链（`create_order`）。
5) 成功后在订单列表与时间线中可见，对应事件同步写入链下。

### Shadcn Card Layout（ASCII）
```
┌───────────────────────────────────────────────────────────────┐
│  Create Order                                                 │
├───────────────────────────────────────────────────────────────┤
│  Warehouse                                                   │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │  Selected: 0xWAREHOUSE…  [Change]                      │ │
│  └─────────────────────────────────────────────────────────┘ │
│                                                               │
│  Logistics (Required)                                         │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │  Carrier: [ SF Express        ]                          │ │
│  │  Tracking No.: [ SF123456789CN ]                         │ │
│  │  Notes: [ optional text…     ]                           │ │
│  └─────────────────────────────────────────────────────────┘ │
│                                                               │
│  Review & Estimate                                            │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │  Amount: 1.0000 APT   Insurance: 0.2500 APT  Fee: 0.075 │ │
│  │  [ Estimate Gas ]     [ Sign & Submit ]                  │ │
│  └─────────────────────────────────────────────────────────┘ │
└───────────────────────────────────────────────────────────────┘
说明：
- “Warehouse” 卡片默认展示来自 Listing 的地址，可通过 Change 返回重新选择。
- “Logistics” 至少需填写 Tracking No.，Carrier / Notes 为可选项。
- “Review & Estimate” 展示金额与费率；PoC 可使用预设值或隐藏复杂字段。
```

### 实现锚点
- `apps/web/features/orders/create/CreateOrderView.tsx`（现有实现）
- `apps/web/features/orders/useOrderDraft.ts`（草稿保存）
- `apps/web/lib/api/orders.ts`（订单查询与详情）
- 从 Listing 打开 Create Order（规划中）：`/orders/new?warehouse=0x…`
