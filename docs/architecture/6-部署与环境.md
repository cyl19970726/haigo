# 6. 部署与环境
- **本地开发**：
- 使用 Docker Compose 启动 Postgres、Hasura、BFF；本地调试时直接指向 Aptos 官方 Indexer GraphQL。若需验证自建 Processor，可额外在 Aptos Build 控制台创建 No-Code Indexer 并连接本地 Postgres。
  - 本地媒体目录挂载至 `./storage/media`，通过 `.env.local` 配置 `MEDIA_ROOT`。
  - `apps/web` 通过 `NEXT_PUBLIC_HASURA_URL`、`NEXT_PUBLIC_BFF_URL` 连接后端。
- **测试网环境**：
  - Aptos 合约部署到测试网，模块地址写入 `packages/shared/config/aptos.ts`。
  - BFF 与 Hasura 部署在单台云主机或 Kubernetes 节点（阿里云 ECS/ACK），开启 HTTPS。
  - 媒体目录挂载云盘（ESSD），每日利用 OSS 同步脚本备份。
- **CI/CD**：
  1. GitHub Actions（或阿里云流水线）三阶段：`move-test`、`backend-test`、`frontend-build`。
  2. 构建产物：Move 模块 `build/`、BFF Docker 镜像、Next.js 静态资源。
  3. 通过环境变量控制部署目标（`ENV=dev/testnet`）。合约部署需人工审批。
- **基础设施即代码**：
  - Terraform 管理 ECS、RDS（Postgres）、OSS Bucket（预留）、安全组；若暂未接入 Terraform，可用阿里云 ROS 模板起步。
  - Ansible/Shell 脚本负责 BFF/Hasura 服务的容器化部署与环境变量注入。
